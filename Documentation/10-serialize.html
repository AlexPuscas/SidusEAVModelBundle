<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Sidus/EAVModelBundle</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css"
          integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <link rel="stylesheet" href="https://vincentchalnot.github.io/SidusEAVModelBundle/css/main.css">
</head>
<body>

<div class="position-relative p-md-3 text-center bg-dark border-bottom mb-4 dark-background"
     style="">
    <div class="my-5">
        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle" class="btn">
            <h1 class="display-4 text-white">
                Sidus/EAVModelBundle&nbsp;<i
                        class="fa fa-database"></i>
            </h1>
        </a>
        <p class="lead font-weight-normal text-white">
            Blazing fast data modeling with Symfony
        </p>
                    <a class="btn btn-dark" href="https://github.com/VincentChalnot/SidusEAVModelBundle" target="_blank">
                View on GitHub <i class="fa fa-code-branch"></i>
            </a>
            </div>
</div>

    <a href="https://github.com/VincentChalnot/SidusEAVModelBundle">
        <img class="fixed-top" style="left:auto"
             src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
             alt="Fork me on GitHub">
    </a>

<main class="container">
    <div class="row">
                    <div class="col-sm-3 pr-4">
                <nav role="navigation">
                                                                    <p class="text-muted">
                            Home
                        </p>

                        <ul class="nav nav-pills flex-column">
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/index.html">
                                        Introduction
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/index.html#example">
                                        Example
                                    </a>
                                </li>
                                                    </ul>
                                                                        <hr>
                                                <p class="text-muted">
                            Main documentation
                        </p>

                        <ul class="nav nav-pills flex-column">
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/01-install.html">
                                        01 - Installation
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/02-model.html">
                                        02 - Model configuration
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/03-multiple.html">
                                        03 - Multiple attributes & collections
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/04-entities.html">
                                        04 - Handling Entities
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/05.1-form.html">
                                        05 - Forms
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/06-validate.html">
                                        06 - Validation
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/07.1-query.html">
                                        07 - Query
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/08-translate.html">
                                        08 - Translating the model
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/09-context.html">
                                        19 - EAV Contextualisation
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/10-serialize.html">
                                        10 - Serialization
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/11-extend.html">
                                        11 - Extending & customizing the model
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/12-custom_classes.html">
                                        12 - Custom classes
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/13-extensions.html">
                                        13 - Extensions
                                    </a>
                                </li>
                                                    </ul>
                                                                        <hr>
                                                <p class="text-muted">
                            Other documentation entries
                        </p>

                        <ul class="nav nav-pills flex-column">
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/100-ide_autocomplete.html">
                                        IDE Autocomplete
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/200-questions.html">
                                        Questions & Answers
                                    </a>
                                </li>
                                                            <li class="nav-item">
                                    <a class="nav-link"
                                       href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/300-performances.html">
                                        Performances
                                    </a>
                                </li>
                                                    </ul>
                    
                </nav>
            </div>

                <section class="col-sm-9">
            <h2 id="serialization">Serialization</h2>
<p>This bundle is compatible with Symfony's Serializer. To enable the normalization services, activate the serializer
option in the configuration:</p>
<pre><code class="language-yaml">sidus_eav_model:
    serializer_enabled: true</code></pre>
<p>Now the normalizer will add the EAV attributes to the normalized data and supports the denormalization of data
containing the EAV attributes.</p>
<p>You can also normalize families and attributes but obviously not denormalize them because they are not meant to be
modified.</p>
<h3 id="custom-options">Custom options</h3>
<p>The behavior of the serializer can be controlled a little bit further than the standard Symfony Serializer, it allows
you to describe the way you want your data serialized with options in the model and in the context during serialization.</p>
<h4 id="model-options">Model options</h4>
<p>You can use the <code>serializer</code> option in your attribute options to tweek the serialization output:</p>
<pre><code class="language-yaml">sidus_eav_model:
    families:
        Post:
            attributes:
                # ... Other attributes
                author:
                    type: data_selector
                    options:
                        serializer:
                            groups: [ ... ]
                            exposer: true|false
                            # For relations only:
                            by_reference: true|false
                            by_short_reference: true|false
                        # ... Other options</code></pre>
<ul>
<li>
<p>The <code>groups</code> option behave just like standard serialization groups in conjunction with the <code>groups</code>
context option.</p>
</li>
<li>
<p>The <code>expose</code> option, if set to false will always block the serialization of the attribute.</p>
</li>
<li>
<p><code>by_reference</code> will only output a limited set of information, check the next paragraph.</p>
</li>
<li>
<p><code>by_short_reference</code> will only output the identifier of the related entity.</p>
</li>
</ul>
<h4 id="context-options">Context options</h4>
<p>If you haven't read the dedicated chapter about the <a href="09-context.html">EAV context</a> you might get confused about the
difference between the <em>EAV</em> context and the <em>Serializer</em> context, which are two completely separate things.</p>
<p>This chapter concerns the <em>Serializer</em> context options but you can also pass the <em>EAV</em> <code>context</code> option inside
your <em>Serializer</em> context options to declare the current EAV context used to normalize or denormalize the entity:</p>
<pre><code class="language-php">&lt;?php
/**
 * @var \Symfony\Component\Serializer\Normalizer\NormalizerInterface $normalizer
 * @var \Sidus\EAVModelBundle\Entity\DataInterface $data
 * @var string $format
 */
$normalizedData = $normalizer-&gt;normalize(
    $data,
    $format,
    [ // Context
        'context' =&gt; [
            'language' =&gt; 'en',
            'channel' =&gt; 'web',
            'publication' =&gt; 'published',
        ],
    ]
);</code></pre>
<p>This works the same way for denormalization.</p>
<h5 id="normalization">Normalization</h5>
<pre><code class="language-php">&lt;?php
/**
 * @var \Symfony\Component\Serializer\Normalizer\NormalizerInterface $normalizer
 * @var \Sidus\EAVModelBundle\Entity\DataInterface $data
 * @var string $format
 */
$normalizedData = $normalizer-&gt;normalize(
    $data,
    $format,
    [ // Context
        'by_reference' =&gt; true,
    ]
);</code></pre>
<p>This will output a limited set of data controlled by this configuration parameter:
<code>sidus_eav_model.normalizer.data.reference_attributes</code></p>
<p>By default it will output the id, identifier, familyCode and label. These information allows any system or human being
to identify the data in a unique way.</p>
<p>You can also choose to extract the short reference, this will only output the identifier property.</p>
<pre><code class="language-php">&lt;?php
/**
 * @var \Symfony\Component\Serializer\Normalizer\NormalizerInterface $normalizer
 * @var \Sidus\EAVModelBundle\Entity\DataInterface $data
 * @var string $format
 */
$identifier = $normalizer-&gt;normalize(
    $data,
    $format,
    [ // Context
        'by_short_reference' =&gt; true,
    ]
);</code></pre>
<h5 id="denormalization">Denormalization</h5>
<p>During denormalization, if the &quot;family&quot; information is not present in the data, you can pass it using the context:</p>
<pre><code class="language-php">&lt;?php

use Sidus\EAVModelBundle\Entity\DataInterface;

/**
 * @var \Symfony\Component\Serializer\Normalizer\DenormalizerInterface $normalizer
 * @var string $format
 * @var string|\Sidus\EAVModelBundle\Model\FamilyInterface $family
 */
$data1 = $normalizer-&gt;denormalize(
    [
        // Can be either of the following:
        'family' =&gt; $family,
        'familyCode' =&gt; $family,
        'family_code' =&gt; $family,
    ],
    DataInterface::class, // Can also be your data class
    $format,
    [ // Context
        // No need to pass the family in the context
    ]
);

$data2 = $normalizer-&gt;denormalize(
    [
        // Data without family info
    ],
    DataInterface::class, // Can also be your data class
    $format,
    [ // Context
        'family' =&gt; $family,
    ]
);</code></pre>
<p>Finally, if you are using single table inheritance for your data class, and have a single family matching your data
class, you can directly use your class and you don't need to provide any family information:</p>
<pre><code class="language-php">&lt;?php

/**
 * @var \Symfony\Component\Serializer\Normalizer\DenormalizerInterface $normalizer
 * @var string $format
 */
$data1 = $normalizer-&gt;denormalize(
    [
        // Data without family info
    ],
    \MyNamespace\EAVModelBundle\Entity\Book::class, // Only if you have a single family matching this data class
    $format,
    [ // Context
        // No need to pass the family in the context
    ]
);</code></pre>
<p>See next chapter for more information about this: <a href="12-custom_classes.html">Custom classes</a></p>
<h3 id="internals">Internals</h3>
<h4 id="specific-configuration">Specific configuration</h4>
<p>The parameter <code>sidus_eav_model.denormalizer.data.ignored_attributes</code> lists a number of properties that will
always be ignored when denormalizing data.</p>
<p>For families: <code>sidus_eav_model.normalizer.family.ignored_attributes</code></p>
<p>And for attributes: <code>sidus_eav_model.normalizer.attribute.ignored_attributes</code></p>
<p>For ignored properties during normalization, this parameter is used:
<code>sidus_eav_model.normalizer.data.ignored_attributes</code>.</p>
<h4 id="entity-provider">Entity provider</h4>
<p>During denormalization, the system often needs to resolve existing entities based on their family and identifier.</p>
<p>This process is controlled by the <code>EntityProvider</code> service and always require a family.
The data passed to the service can be:</p>
<ul>
<li>A scalar: The service will try to find the entity by identifier and fallback to the id.</li>
<li>An array: The service will check for the id property and then for the identifier property.</li>
</ul>
<p>This service also keeps tracks of created entities before flush in order to allow associations with entities that have
not been flushed yet.</p>
        </section>
    </div>
</main>

<footer class="container-fluid mt-4">
    <div class="row">
        <div class="col-12 text-center border-top pt-4 pb-4">
            <span>
                                    Copyright <a href="https://twitter.com/VincentChalnot" target="_blank">@VincentChalnot</a> 2015-2018 with special thanks to <a href="https://www.clever-age.com/" target="_blank">Clever-Age</a>
                            </span>
        </div>
    </div>
</footer>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>

<script>
    hljs.initHighlighting();
</script>
</body>
</html>
