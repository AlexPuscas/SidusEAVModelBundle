<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Sidus/EAVModelBundle</title>

        <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Merriweather:400,900,700,300|Open+Sans:400,800,700|Titillium+Web:600,400' type='text/css'>
        <link rel="stylesheet" href="https://vincentchalnot.github.io/SidusEAVModelBundle/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://vincentchalnot.github.io/SidusEAVModelBundle/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://vincentchalnot.github.io/SidusEAVModelBundle/css/github.css">
        <link rel="stylesheet" href="https://vincentchalnot.github.io/SidusEAVModelBundle/css/main.css">
    </head>
    <body>

        <header class="site-header">
            <div class="site-branding">
                <h1 class="site-name">
                    <a href="https://vincentchalnot.github.io/SidusEAVModelBundle" >Sidus/EAVModelBundle</a>&nbsp;&nbsp;<i class="fa fa-database"></i>
                </h1>
                <h2 class="site-description">Blazing fast data modeling with Symfony</h2>
            </div>

            <div class="button-line">
                <a href="https://github.com/VincentChalnot/SidusEAVModelBundle" target="_blank" class="btn btn-default">View on GitHub</a>
                <a href="https://github.com/VincentChalnot/SidusEAVModelBundle/zipball/master" class="btn btn-default hidden-xs">Download .zip</a>
                <a href="https://github.com/VincentChalnot/SidusEAVModelBundle/tarball/master" class="btn btn-default hidden-xs">Download .tar.gz</a>
            </div>

                            <a href="https://github.com/VincentChalnot/SidusEAVModelBundle">
                    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
                </a>
            
            <div class="text-left visible-xs-block" style="margin-left: 15px;">
                <a href="#sidebar" data-toggle="collapse"><i class="fa fa-3x fa-bars" aria-hidden="true"></i></a>
            </div>
        </header>

        <main class="container-fluid">
            <div class="row">

                                    <nav id="sidebar" class="col-sm-3 col-lg-2 collapse in" role="navigation">
                                                    <p class="text-muted">
                                Home
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/index.html">
                                            Introduction
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/index.html#example">
                                            Example
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                Main documentation
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/01-install.html">
                                            01 - Installation
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/02-model.html">
                                            02 - Model configuration
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/03-multiple.html">
                                            03 - Multiple attributes & collections
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/04-entities.html">
                                            04 - Handling Entities
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/05.1-form.html">
                                            05 - Forms
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/06-validate.html">
                                            06 - Validation
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/07.1-query.html">
                                            07 - Query
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/08-translate.html">
                                            08 - Translating the model
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/09-context.html">
                                            19 - EAV Contextualisation
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/10-serialize.html">
                                            10 - Serialization
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/11-extend.html">
                                            11 - Extending & customizing the model
                                        </a>
                                    </li>
                                                                    <li class="active">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/12-custom_classes.html">
                                            12 - Custom classes
                                        </a>
                                    </li>
                                                            </ul>
                                                    <p class="text-muted">
                                Other documentation entries
                            </p>

                            <ul class="nav nav-pills nav-stacked">
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/100-ide_autocomplete.html">
                                            IDE Autocomplete
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/200-questions.html">
                                            Questions & Answers
                                        </a>
                                    </li>
                                                                    <li class="">
                                        <a href="https://vincentchalnot.github.io/SidusEAVModelBundle/Documentation/300-performances.html">
                                            Performances
                                        </a>
                                    </li>
                                                            </ul>
                        
                    </nav>

                
                <section class="col-sm-9 col-lg-10 content">
                    <h2 id="custom-classes">Custom classes</h2>
<p>The default behavior for EAV Data entities hydration in Doctrine is to use a single class.
This is the &quot;Data&quot; class you need to create and configure at the installation of this bundle.</p>
<p>However, there is an alternative behavior you can setup by using Doctrine's single table inheritance,
using this feature you can actually have a different class for each Family in the EAV model.</p>
<blockquote>
<p><strong>NOTE</strong>:\
This feature is mandatory when using certain external bundles that requires a different class for each different
model, like SonataAdmin, ApiPlatform, etc.</p>
</blockquote>
<h3 id="setup-your-data-class">Setup your Data class</h3>
<p>Add the following two annotations to your Data class:</p>
<pre><code class="language-phpdoc">@ORM\InheritanceType("SINGLE_TABLE")
@ORM\DiscriminatorColumn(name="discr", type="string")</code></pre>
<p>So your class should looks like this:</p>
<pre><code class="language-php">&lt;?php

namespace MyNamespace\EAVModelBundle\Entity;

use Doctrine\ORM\Mapping as ORM;
use Sidus\EAVModelBundle\Entity\AbstractData;

/**
 * @ORM\Table(name="mynamespace_data", indexes={
 *     @ORM\Index(name="family", columns={"family_code"}),
 *     @ORM\Index(name="updated_at", columns={"updated_at"}),
 *     @ORM\Index(name="created_at", columns={"created_at"})
 * })
 * @ORM\Entity(repositoryClass="Sidus\EAVModelBundle\Entity\DataRepository")
 * @ORM\InheritanceType("SINGLE_TABLE")
 * @ORM\DiscriminatorColumn(name="discr", type="string")
 */
class Data extends AbstractData
{
}</code></pre>
<p>Because of the way the EAV model works, it is not possible to use different entities mapped to different tables on the
database side. That's why you need to use single table inheritance.
(It would probably also works with joined table inheritance but who uses that anyway?)</p>
<h4 id="update-your-schema">Update your schema</h4>
<p>If you have already created your schema, you need to update it because Doctrine will add the discriminator column to
it in order for the inheritance to work.</p>
<h3 id="create-your-custom-class">Create your custom class</h3>
<p>Create the class that will be used by your family.
By convention you should name it the same way than your family.</p>
<p>Note that it is possible but not advised to use the same custom data class for multiple families.</p>
<pre><code class="language-php">&lt;?php

namespace MyNamespace\EAVModelBundle\Entity;

use Doctrine\ORM\Mapping as ORM;

/**
 * @ORM\Entity(repositoryClass="Sidus\EAVModelBundle\Entity\DataRepository")
 */
class MyFamily extends Data
{
}</code></pre>
<h3 id="configure-your-family">Configure your family</h3>
<pre><code class="language-yaml">sidus_eav_model:
    families:
        MyFamily:
            data_class: MyNamespace\EAVModelBundle\Entity\MyFamily
            # ...</code></pre>
<h4 id="update-your-existing-data">Update your existing data</h4>
<p>If you already had data for this family stored in your database, the discriminator column needs to be updated,
you can use the following command to do this:</p>
<pre><code class="language-bash">$ bin/console sidus:data:fix-discriminator</code></pre>
                </section>

            </div>
        </main>

        <footer class="site-footer">
            <div class="top-bar-line"></div>
            <div class="bottom-panel">
                <div class="text-center">
            <span>
                                    Copyright @VincentChalnot 2015-2018 with special thanks to Clever-Age
                                                </span>
                </div><!-- text-center -->
            </div><!-- bottom-panel -->
        </footer>


        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="https://vincentchalnot.github.io/SidusEAVModelBundle/js/highlight.pack.js"></script>

        <script>
            hljs.initHighlighting();

            function checkWidth($highlight) {
                if ($(window).width() < 768) {
                    $highlight.addClass('collapse');
                } else {
                    $highlight.removeClass('collapse');
                }
            }

            $(document).ready(function () {
                var $highlights = $('.hljs');
                $highlights.each(function (index) {
                    var $this = $(this).parent();
                    var elementId = 'hljs' + index;
                    $this.attr('id', elementId);
                    $this.before('<a class="visible-xs-inline visible-sm-inline" href="#' + elementId + '" data-toggle="collapse"><i class="fa fa-expand"></i>&nbsp;Toggle source code ...</a>');

                    checkWidth($this);
                    $(window).resize(function () {
                        checkWidth($this);
                    });
                });
            });

            
        </script>

    </body>
</html>
